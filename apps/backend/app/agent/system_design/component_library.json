[

  {
    "id": "auth-service-supabase",
    "name": "Supabase Auth + LangGraph",
    "type": "api",
    "description": "Validates Supabase JWT bearer tokens for every backend request and surfaces the authenticated user id.",
    "owner": "Platform/Backend Team",
    "inputs": [
      "HTTP Authorization header: Bearer <jwt>",
      "Relevant env vars: SUPABASE_URL, SUPABASE_JWKS_URL, SUPABASE_ANON_KEY, SUPABASE_JWT_SECRET",
      "Get JWKS client for Supabase token validation: use SUPABASE_ANON_KEY.",
      "Authenticate requests using Supabase JWT tokens. Args: authorization: Bearer token from Authorization header",
      "Default authorization: allow all authenticated users."
    ],
    "outputs": [
      "Authenticated user_id (string) injected into request context",
      "HTTP 401/500 error responses on failure"
    ],
    "protocols": [
      "HTTPS (for JWKS fetch)",
      "HTTP Authorization header contract"
    ],
    "apis": [
      "apps/backend/app/auth.py (authenticate, authorize_default)"
    ],
    "scaling_limits": "Stateless verification; limited by backend concurrency. JWKS client caches keys (LRU=1).",
    "dependencies": [
      "Supabase JWKS endpoint (env: SUPABASE_JWKS_URL or SUPABASE_URL)",
    "Supabase anon key / JWT secret env vars",
    "langgraph_sdk.Auth middleware",
    "PyJWT library"
    ],
    "performance": "JWKS keys cached in-process; verification typically <50ms when keys cached.",
    "refs": [
      "https://supabase.com/docs/guides/auth"
    ],
    "repos": [
      "apps/backend/app/auth.py"
    ],
    "notes": [
      "Fails closed if JWKS/secret env vars missing (returns 401).",
      "Set SUPABASE_ANON_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY for public access."
    ]
  },
  {
    "id": "user-db-postgres",
    "name": "User Database (Postgres)",
    "type": "db",
    "description": "Primary relational store for users, profiles, and related account metadata.",
    "owner": "Platform/Backend Team",
    "inputs": [
      "PostgreSQL connections (read/write) via app backend",
      "Schema migrations from backend migrations tool"
    ],
    "outputs": [
      "Query results for user/profile/account data"
    ],
    "protocols": [
      "PostgreSQL"
    ],
    "data_contracts": [
      "SQL schema: users, profiles, sessions (see migrations)",
      "Connection string in env (e.g., DATABASE_URL)"
    ],
    "apis": [
      "apps/backend/ (application data access layer / ORM or queries)"
    ],
    "scaling_limits": "Constrained by max connections and instance size; use pooler if available.",
    "dependencies": [
      "Connection pooler (if enabled)",
      "Backups and retention policy (Postgres/Supabase)",
      "Read replicas (if provisioned)"
    ],
    "performance": "p95 query latency typically low-ms for indexed lookups; monitor slow queries.",
    "refs": [
      "https://supabase.com/dashboard/project/goohwpauxyxzndmjsomb/database/schemas"
    ],
    "repos": [
      "supabase/migrations"
    ],
    "notes": [
      "supabase/migrations for baseline schema and migrations",
      "Sessions pooler configuration"
    ]
  },
  {
    "id": "api-backend",
    "name": "Backend API (LangGraph)",
    "type": "api",
    "description": "Primary backend/API surface hosting LangGraph agents (planner, research, design, etc.).",
    "owner": "Backend Team",
    "inputs": [
      "HTTP requests with Authorization: Bearer <jwt>",
      "Agent payloads routed through LangGraph nodes"
    ],
    "outputs": [
      "JSON responses from orchestrator/agents"
    ],
    "protocols": [
      "HTTPS",
      "HTTP Authorization header contract"
    ],
    "data_contracts": [
      "API routes implemented under apps/backend/app",
      "Auth via Supabase JWT validated in auth middleware"
    ],
    "apis": [
      "apps/backend/app/ (FastAPI/LangGraph handlers)"
    ],
    "scaling_limits": "Bound by app server concurrency and downstream dependencies (DB, auth).",
    "dependencies": [
      "auth-service-supabase (JWT validation)",
      "user-db-postgres (state, checkpoints, usage)",
      "Supabase JWT keys (JWKS/secret)"
    ],
    "performance": "Stateless handlers; depends on DB latency and token verification.",
    "refs": [
      "apps/backend/app/auth.py",
      "apps/backend/app/agent/system_design/"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Requires Supabase env vars for auth",
      "Orchestrates LangGraph agent flows"
    ]
  },
  {
    "id": "orchestrator",
    "name": "LangGraph Orchestrator",
    "type": "orchestrator",
    "description": "Supervises agent phases (planner, research, design, critic, evals) and routes state between subnodes.",
    "owner": "Backend Team",
    "inputs": [
      "Agent state (messages, metadata, plan/research/design/critic/evals states)",
      "Triggers from API/backend entrypoints"
    ],
    "outputs": [
      "Updated run state with next phase decisions",
      "Commands to subnodes (e.g., planner_steps, research_agent, design_agent, critic_agent, evals_agent)"
    ],
    "protocols": [
      "In-process function calls within LangGraph runtime"
    ],
    "data_contracts": [
      "LangGraph state shape in apps/backend/app/agent/system_design/state.py"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (orchestrator)"
    ],
    "scaling_limits": "Bound by app server concurrency and downstream node latencies.",
    "dependencies": [
      "api-backend (entrypoint)",
      "auth-service-supabase (JWT validation before orchestration)",
      "user-db-postgres (state/checkpoints via checkpoint tables)"
    ],
    "performance": "Lightweight routing; depends on subnode compute and DB access.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py",
      "apps/backend/app/agent/system_design/state.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Advances run_phase and invokes planner/research/design/critic/evals agents.",
      "Always returns back to orchestrator"
    ]
  },
  {
    "id": "planner_agent",
    "name": "Planner Agent",
    "type": "agent",
    "description": "Generates and refines high-level plans/steps for the run before research/design phases.",
    "owner": "Backend Team",
    "inputs": [
      "Goal and recent messages from state",
      "Existing plan_scope and plan_state (if any)"
    ],
    "outputs": [
      "plan_scope (goal, issues, risks, needs_clarifier)",
      "plan_state (steps, summary, risks, quality)"
    ],
    "protocols": [
      "In-process LangGraph node calls"
    ],
    "data_contracts": [
      "State fields plan_scope/plan_state in apps/backend/app/agent/system_design/state.py"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (planner_agent, planner_scope, planner_steps)"
    ],
    "scaling_limits": "LLM-bound; cost/latency depends on call_brain usage.",
    "dependencies": [
      "api-backend (entrypoint)",
      "auth-service-supabase (JWT validation before API)",
      "user-db-postgres (state/checkpoints via checkpoint tables)",
      "orchestrator (phase routing)"
    ],
    "performance": "Depends on LLM model latency and token usage.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py",
      "apps/backend/app/agent/system_design/state.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Writes plan_scope and plan_state; may trigger clarifier via orchestrator when blocking issues are present.",
      "Always returns back to orchestrator"
    ]
  },
  {
    "id": "research_agent",
    "name": "Research Agent",
    "type": "agent",
    "description": "Aggregates knowledge_base, github_api, and web_search nodes to produce research highlights, citations, and risks.",
    "owner": "Backend Team",
    "inputs": [
      "Goal, metadata (github_repo/search_query), and current state",
      "Outputs from subnodes (knowledge_base_node, github_api_node, web_search_node)"
    ],
    "outputs": [
      "research_state (nodes outputs, highlights, citations, risks)",
      "research_summary (short highlights summary)"
    ],
    "protocols": [
      "In-process LangGraph node calls"
    ],
    "data_contracts": [
      "State fields research_state/research_highlights/research_citations/research_summary"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (research_agent)"
    ],
    "scaling_limits": "Bound by subnode calls (LLM + external APIs); handles missing deps gracefully.",
    "dependencies": [
      "api-backend (entrypoint)",
      "auth-service-supabase (JWT validation before API)",
      "user-db-postgres (state/checkpoints)",
      "orchestrator (phase routing)",
      "External: web search (Tavily), GitHub API (optional), Supabase KB (optional)"
    ],
    "performance": "Depends on external API latency and LLM calls if used.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Combines knowledge_base, github_api, and web_search node outputs; status is completed if any node completes."
    ]
  },
  {
    "id": "knowledge_base_node",
    "name": "Knowledge Base Node",
    "type": "subagent",
    "description": "Fetches knowledge base entries (Supabase or metadata) to surface highlights, citations, and risks.",
    "owner": "Backend Team",
    "inputs": [
      "Goal/metadata from state",
      "kb_entries from metadata or Supabase table lookup"
    ],
    "outputs": [
      "highlights, citations, risks, status, notes via _research_payload"
    ],
    "protocols": [
      "In-process call from research_agent"
    ],
    "data_contracts": [
      "Knowledge base table/entries shape (id, title, summary/note, url, risks)"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (knowledge_base_node)"
    ],
    "scaling_limits": "DB/lookup latency; optional Supabase dependency.",
    "dependencies": [
      "Supabase knowledge_base table (optional)",
      "api-backend/auth for upstream access"
    ],
    "performance": "Fast lookup; no LLM calls in this node.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Returns status completed when entries found; otherwise skipped with reason.",
      "Always returns back to its agent, never talks directly to anything else."
    ]
  },
  {
    "id": "planner_step_formatter",
    "name": "Planner Step Formatter",
    "type": "subagent",
    "description": "Normalizes LLM-generated plan steps into structured entries (ids, titles, details, flags) and computes plan quality.",
    "owner": "Backend Team",
    "inputs": [
      "Goal, plan_scope (risks/issues), LLM raw steps/summary"
    ],
    "outputs": [
      "plan_state.steps normalized (id/title/detail/needs_research/needs_cost/metadata)",
      "plan_state.summary, risks, quality score"
    ],
    "protocols": [
      "In-process LangGraph node calls"
    ],
    "data_contracts": [
      "plan_state shape in apps/backend/app/agent/system_design/state.py"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (planner_steps)"
    ],
    "scaling_limits": "LLM-bound for generation; normalization is lightweight.",
    "dependencies": [
      "planner_agent",
      "call_brain (LLM) via planner_steps"
    ],
    "performance": "Minimal beyond LLM call; uses local normalization and quality heuristic.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Adds TODO step when issues present; caps step count and dedupes risks; computes heuristic quality.",
      "Always returns back to its agent, never talks directly to anything else."
    ]
  },
  {
    "id": "planner_scope_analyzer",
    "name": "Planner Scope Analyzer",
    "type": "subagent",
    "description": "Evaluates goal/input to identify blocking issues, info gaps, risks, and whether clarification is needed.",
    "owner": "Backend Team",
    "inputs": [
      "goal and latest user input (messages)",
      "existing plan_scope (if any)"
    ],
    "outputs": [
      "plan_scope (goal, latest_input, memory_highlights, info_issues, blocking_issues, needs_clarifier, risks, status)"
    ],
    "protocols": [
      "In-process LangGraph node calls"
    ],
    "data_contracts": [
      "plan_scope shape in apps/backend/app/agent/system_design/state.py"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (planner_scope)"
    ],
    "scaling_limits": "Lightweight heuristic/LLM call; minimal overhead.",
    "dependencies": [
      "planner_agent",
      "call_brain (LLM) if needed for heuristic evaluation"
    ],
    "performance": "Fast unless LLM invoked for classification.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py",
      "apps/backend/app/agent/system_design/state.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Sets needs_clarifier/blocking_issues; feeds into planner and orchestrator.",
      "Always returns back to its agent, never talks directly to anything else."
    ]
  },
  {
    "id": "web_search_node",
    "name": "Web Search Node",
    "type": "subagent",
    "description": "Executes external web search (Tavily or provided metadata results) and returns highlights/citations.",
    "owner": "Backend Team",
    "inputs": [
      "Search query from metadata or goal",
      "Optional preloaded web_results from metadata"
    ],
    "outputs": [
      "highlights, citations, status, notes via _research_payload"
    ],
    "protocols": [
      "In-process call from research_agent"
    ],
    "data_contracts": [
      "Search result structure (title/url/snippet/content)"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (web_search_node)"
    ],
    "scaling_limits": "Bound by Tavily/API latency; skipped if no query.",
    "dependencies": [
      "External: Tavily API (TAVILY_API_KEY)",
      "api-backend/auth for upstream access"
    ],
    "performance": "External HTTP call; lightweight processing locally.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Returns status completed when highlights/citations exist; else skipped with reason.",
      "Always returns back to its agent, never talks directly to anything else."
    ]
  },
  {
    "id": "ui-frontend",
    "name": "User Interface",
    "type": "ui",
    "description": "Front-end surface for interacting with LangGraph agents (submit goals, view outputs, clarify).",
    "owner": "Frontend/Backend Team",
    "inputs": [
      "User-authenticated HTTP requests",
      "Goal/clarifications/messages"
    ],
    "outputs": [
      "Rendered agent results (plans, research highlights, designs, evals)",
      "Clarifier prompts and responses"
    ],
    "protocols": [
      "HTTPS",
      "HTTP Authorization header contract (Supabase JWT)"
    ],
    "data_contracts": [
      "API responses from api-backend (JSON)"
    ],
    "apis": [
      "apps/web/ (if present) or consuming api-backend endpoints"
    ],
    "scaling_limits": "Bound by frontend hosting and backend API latency.",
    "dependencies": [
      "auth-service-supabase (JWT issuance/validation)",
      "api-backend (agent orchestration and data)"
    ],
    "performance": "Mostly network/edge-bound; backend latency dominates.",
    "refs": [
      "api-backend routes"
    ],
    "repos": [
      "apps/web/ (if present)",
      "apps/backend/ (API it consumes)"
    ],
    "notes": [
      "Acts only as a client; does not bypass orchestrator."
    ]
  },
  {
    "id": "component_library_node",
    "name": "Component Library Node",
    "type": "subagent",
    "description": "Design-phase subnode that loads component_library.json and returns available components for architecture assembly.",
    "owner": "Backend Team",
    "inputs": [
      "Design state and goal (for context)",
      "Local component_library.json"
    ],
    "outputs": [
      "components array, metadata (source path, count), notes, status"
    ],
    "protocols": [
      "In-process call from design_agent"
    ],
    "data_contracts": [
      "Component entry schema in component_library.json"
    ],
    "apis": [
      "apps/backend/app/agent/system_design/nodes.py (component_library_node)"
    ],
    "scaling_limits": "Local file read; negligible latency.",
    "dependencies": [
      "component_library.json",
      "design_agent",
      "api-backend/auth for upstream access"
    ],
    "performance": "Fast, file I/O only.",
    "refs": [
      "apps/backend/app/agent/system_design/nodes.py",
      "apps/backend/app/agent/system_design/component_library.json"
    ],
    "repos": [
      "apps/backend/"
    ],
    "notes": [
      "Status completed if components loaded; skipped if missing/parse error.",
      "Always returns back to its agent, never talks directly to anything else."
    ]
  }
]
